<!DOCTYPE html>
<html lang="zh-cn">
  <head><meta name="generator" content="Hexo 3.8.0">
    
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">

<meta name="theme-color" content="#f8f5ec">
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">



  <meta name="description" content="傻傻分不清之 —— babel 全家桶">




  <meta name="keywords" content="Vince, Vince's Blog,前端,Node,React">










  <link rel="alternate" href="/default" title="Vince's Blog">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.10.2">



<link rel="canonical" href="https://vince.xin/2019/06/29/傻傻分不清之-——-babel-全家桶/">



  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css">




  <link rel="stylesheet" type="text/css" href="/lib/nprogress/nprogress.min.css">



<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.10.2">



  



  <script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>









<script>
  window.config = {"leancloud":{"app_id":null,"app_key":null},"toc":true,"fancybox":true,"pjax":true};
</script>

    <title> 傻傻分不清之 —— babel 全家桶 - Vince's Blog </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Vince's Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            首页
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            归档
          
        </li>
      </a>
    
      <a href="/tags">
        <li class="mobile-menu-item">
          
          
            标签
          
        </li>
      </a>
    
      <a href="/categories">
        <li class="mobile-menu-item">
          
          
            分类
          
        </li>
      </a>
    
      <a href="/about">
        <li class="mobile-menu-item">
          
          
            关于
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Vince's Blog</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              首页
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              归档
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/tags">
            
            
              标签
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/categories">
            
            
              分类
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/about">
            
            
              关于
            
          </a>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          傻傻分不清之 —— babel 全家桶
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2019-06-29
        </span>
        
          <span class="post-category">
            
              <a href="/categories/JavaScript/">JavaScript</a>
            
          </span>
        
        
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#babel-做了什么？"><span class="toc-text">babel 做了什么？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#babel-执行过程"><span class="toc-text">babel 执行过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#解析"><span class="toc-text">解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#转换"><span class="toc-text">转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#生成"><span class="toc-text">生成</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用方式"><span class="toc-text">使用方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#babel-loader"><span class="toc-text">babel-loader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#babel-core"><span class="toc-text">babel-core</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#babel-cli"><span class="toc-text">babel-cli</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#babel-node"><span class="toc-text">babel-node</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#插件-plugin-与预设-preset"><span class="toc-text">插件 plugin 与预设 preset</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#plugin"><span class="toc-text">plugin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#preset"><span class="toc-text">preset</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#执行顺序"><span class="toc-text">执行顺序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#其他重要的东西"><span class="toc-text">其他重要的东西</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#babel-preset-env"><span class="toc-text">babel-preset-env</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#babel-register"><span class="toc-text">babel-register</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#babel-polyfill"><span class="toc-text">babel-polyfill</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#babel-runtime-amp-babel-plugin-transform-runtime"><span class="toc-text">babel-runtime &amp; babel-plugin-transform-runtime</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-text">总结</span></a></li></ol>
    </div>
  </div>



    <div class="post-content">
      
        <p>babel 是一个强大的工具，它包含非常多的包，具体都是用来做什么的呢，这篇长文或许能解答你的部分问题。</p>
<a id="more"></a>
<h2 id="babel-做了什么？"><a href="#babel-做了什么？" class="headerlink" title="babel 做了什么？"></a>babel 做了什么？</h2><p>babel 的诞生给前端带来高效率的编程，为什么这么说呢？正在看该篇文章的你或多或少用了 ES6+ 的语法，并且项目打包后，代码能够很好地运行在不支持 ES6+ 语法的浏览器上，这是因为你的 ES6+ 代码被 babel 转换为 ES5 的代码，这样才能够完美地运行你的代码。</p>
<p>所以，babel 做的事情，就是将一种语法规范转换成另外一种你需要的语法规范，这个执行过程和步骤我们将会在以下章节里讲解。</p>
<h2 id="babel-执行过程"><a href="#babel-执行过程" class="headerlink" title="babel 执行过程"></a>babel 执行过程</h2><p>babel 的大概运行过程为：解析字符串代码生成 AST -&gt; 将 AST 转换为新的 AST -&gt; 将 AST 生成字符串代码，大致的过程如图所示：</p>
<p><img src="http://static4.vince.xin/F6A31ABA-C2C2-4203-910F-B08C3EA1FB5B.png" alt="image"></p>
<h3 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h3><p>对于字符串形式的 JavaScript 代码计算机是不方便处理的，所以我们将字符串结构通过 Babylon 解析器进行词法分析、语法分析后，转换为计算机更易处理的表现形式，称为抽象语法树（AST）。</p>
<h3 id="转换"><a href="#转换" class="headerlink" title="转换"></a>转换</h3><p>转换成 AST 后，其结构已经是一个树状结构，相比于字符结构，我们更易进行分析与修改，如何修改是由指定的 babel-plugin-xxx 决定的，也就是说这个过程的转换结果是由 plugin 决定的。</p>
<h3 id="生成"><a href="#生成" class="headerlink" title="生成"></a>生成</h3><p>AST 经过转换后，其本质上还是 AST 结构，这个时候我们反向处理，将 AST 树状结构再次转换为字符形式，到这一步，babel 转换过程也算是结束了。</p>
<h2 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h2><p>babel 在发展过程中，产生了多种使用方式，主要的由以下几种</p>
<ul>
<li>在构建工具中使用，如我们最常见的 webpack 中的 babel-loader 用来转换 .js 文件</li>
<li>命令行工具中使用 babel ，如 babel-cli 就是一个命令行工具</li>
<li>在逻辑代码中使用 babel，如某些业务逻辑需要使用 babel 中的 API 进行转码，我们就能使用 babel-core</li>
<li>在命令行中直接运行「未来规范」的代码，假设本地 node 版本还不支持新的语法规范，就能使用 babel-node 在命令行中运行「新语法规范」的代码</li>
</ul>
<h3 id="babel-loader"><a href="#babel-loader" class="headerlink" title="babel-loader"></a>babel-loader</h3><p>babel-loader 是配合 webpack 使用的，其作用就是在 webpack 打包过程中，转换 .js 或者 .tx 的文件，我们在 weboack.config.js 中配置类似如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">module: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: /\.js$/,</span><br><span class="line">      exclude: /(node_modules|bower_components)/,</span><br><span class="line">      loader: &apos;babel-loader&apos;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当 webpack 进行 babel-loader 转换的时候，会读取 .babelrc 配置文件，.babelrc 中的内容会告知 babel-loader 如何转换代码，.babelrc 文件类似如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   &quot;presets&quot;: [</span><br><span class="line">     &quot;es2015&quot;,</span><br><span class="line">     &quot;react&quot;,</span><br><span class="line">     &quot;stage-2&quot;</span><br><span class="line">   ],</span><br><span class="line">   &quot;plugins&quot;: []</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h3 id="babel-core"><a href="#babel-core" class="headerlink" title="babel-core"></a>babel-core</h3><p>在 node 中，如果某些代码需要用到 babel 中的方法，那么就可以引入 babel-core 包，直接使用里面包含的 API，如以下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">var babel = require(&apos;babel-core&apos;);</span><br><span class="line"></span><br><span class="line">// 字符串转码</span><br><span class="line">babel.transform(&apos;code();&apos;, options);</span><br><span class="line">// =&gt; &#123; code, map, ast &#125;</span><br><span class="line"></span><br><span class="line">// 文件转码（异步）</span><br><span class="line">babel.transformFile(&apos;filename.js&apos;, options, function(err, result) &#123;</span><br><span class="line">  result; // =&gt; &#123; code, map, ast &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 文件转码（同步）</span><br><span class="line">babel.transformFileSync(&apos;filename.js&apos;, options);</span><br><span class="line">// =&gt; &#123; code, map, ast &#125;</span><br><span class="line"></span><br><span class="line">// Babel AST转码</span><br><span class="line">babel.transformFromAst(ast, code, options);</span><br><span class="line">// =&gt; &#123; code, map, ast &#125;</span><br></pre></td></tr></table></figure>
<h3 id="babel-cli"><a href="#babel-cli" class="headerlink" title="babel-cli"></a>babel-cli</h3><p>babel-cli 提供 cli 命令行工具来进行转码，你可以全局安装 babel-cli，然后对目录下的文件进行转码：</p>
<p><code>npm i babel-cli -g</code></p>
<p>然后在目录下创建<code>index.js</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var a = &apos;vince&apos;;</span><br><span class="line">var funA = () =&gt; &#123;</span><br><span class="line">    console.log(a)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">funA()</span><br></pre></td></tr></table></figure>
<p>这个时候我们运行 <code>babel index.js</code>，发现输出还是原来的代码，这是因为你还没有指定<code>.babelrc</code> 文件，该代码用到了 ES6 的箭头函数，那么我们就需要安装指定的 plugin，<code>babel-plugin-transform-es2015-arrow-functions</code> 就是专门用来转换箭头函数的 plugin，我们在当前目录下创建 <code>.babelrc</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;presets&quot;: [],</span><br><span class="line">    &quot;plugins&quot;: [</span><br><span class="line">        &quot;transform-es2015-arrow-functions&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>设置好了之后别忘记下载依赖 <code>npm install --save-dev babel-plugin-transform-es2015-arrow-functions</code>，这个时候我们再次运行<code>babel index.js</code>，得到以下结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  babel-cli-test babel index.js</span><br><span class="line">var a = &apos;vince&apos;;</span><br><span class="line">var funA = function () &#123;</span><br><span class="line">    console.log(a);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">funA();</span><br></pre></td></tr></table></figure>
<h3 id="babel-node"><a href="#babel-node" class="headerlink" title="babel-node"></a>babel-node</h3><p>babel-node 是 babel-cli 的一部分，它不需要单独安装，这也是一个命令行工具，相当于本地的 node 指令，只不过可以运行 ES6 的代码，因为它内置 bebel-polyfill 和 bebel-register，我们创建含有 ES6 的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let a = &apos;vince&apos;;</span><br><span class="line">let funA = () =&gt; &#123;</span><br><span class="line">    console.log(a)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">funA()</span><br></pre></td></tr></table></figure>
<p>假设你目前的 node 版本不支持 ES6 语法，直接 <code>node index.js</code> 是无法正常执行的，那么 babel-node 就是为了解决该问题，<code>babel-node index.js</code></p>
<p>到这里，我们已经讲解完了 babel 的主要几种用法，下面我们将会探讨它的一些细节和周边。</p>
<h2 id="插件-plugin-与预设-preset"><a href="#插件-plugin-与预设-preset" class="headerlink" title="插件 plugin 与预设 preset"></a>插件 plugin 与预设 preset</h2><h3 id="plugin"><a href="#plugin" class="headerlink" title="plugin"></a>plugin</h3><p>插件就是在 babel 进行「转换」步骤时需要注入的配置，如上述的<code>babel-plugin-transform-es2015-arrow-functions</code> 来转换箭头函数的方法，这个概念也非常容易理解，也就是向 babel 工具注入转换代码的函数。</p>
<h3 id="preset"><a href="#preset" class="headerlink" title="preset"></a>preset</h3><p>在上述讲解中，我们已经知道了 plugin 是用来告诉 babel 工具如何转换代码，那么preset 又是什么呢？我们回忆上述用 <code>babel-plugin-transform-es2015-arrow-functions</code> 来转换箭头函数的方法，那么假设我们代码中含有 <code>let</code>、<code>结构赋值</code>、<code>模版字符串</code>等新规范，那岂不是要下载一大堆 plugin ，preset 就是为了解决该问题而诞生的。</p>
<p>我们看到 <a href="https://www.npmjs.com/package/babel-preset-react" target="_blank" rel="noopener">babel-preset-react</a>，它的文档介绍如下：</p>
<blockquote>
<p>This preset includes the following plugins/presets:<br>preset-flow<br>syntax-jsx<br>transform-react-jsx<br>transform-react-display-name</p>
</blockquote>
<p>意思就是 babel-preset-react 包含了以上插件或者预设，我们从其 Dependencies 中也能看书其依赖了哪些插件与预设：</p>
<p><img src="http://static4.vince.xin/CEB5051C-02F0-4C08-A3A2-AEC425BDF89C.png" alt="image"></p>
<h3 id="执行顺序"><a href="#执行顺序" class="headerlink" title="执行顺序"></a>执行顺序</h3><p>从官方文档我们可以知道的几条执行原则：</p>
<ul>
<li>先执行完所有 plugin，再执行 preset。</li>
<li>多个 plugin，按照声明次序顺序执行。</li>
<li>多个 preset，按照声明次序逆序执行。</li>
</ul>
<p>我们需要按照这个原则来编写我们的 babelrc 配置，如以下配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;presets&quot;: [&quot;es2015&quot;, &quot;react&quot;, &quot;stage-2&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将按如下顺序执行：stage-2、react 然后是 es2015。</p>
<p>这主要的是为了确保向后兼容，因为大多数用户将 “es2015” 排在 “stage-0” 之前,我们要先将更新的语法规范转译后，再去转译旧的语法规范，这样菜确保不出错。</p>
<h2 id="其他重要的东西"><a href="#其他重要的东西" class="headerlink" title="其他重要的东西"></a>其他重要的东西</h2><p>上述是整个 babel 大体上的生态与概念，以下我将会介绍一些比较重要的插件、工具以及概念。</p>
<h3 id="babel-preset-env"><a href="#babel-preset-env" class="headerlink" title="babel-preset-env"></a>babel-preset-env</h3><p>在介绍该 preset 之前，我们思考一个这样的场景，在你的项目中，使用到了 ES6 、ES7甚至 ES8 等新的语法规范，这样我们就要找到这三个新规范的预设，最后将代码全部打包为 ES5 规范，这个时候，你会发现打包后的文件非常的大，对用户首屏体验非常不友好。</p>
<p>正在你非常沮丧的时候，大数据分析师跑过来告诉你：“我们项目的目标用户是年轻人，基本上大家用的都是新型浏览器，没有几个用户还在用IE”，这个时候你灵机一动想着：“我只要兼容最近几年的浏览器版本即可，不需要再将所有的代码都打包为 ES5 规范，因为新的浏览器版本早已经支持了大部分 ES6 规范了”，然而分析完后，你会发现你要做的事情如下：</p>
<ol>
<li>分析各大浏览器厂商最近几年发布的版本，如 Chrome、 Safari、 Firefox等</li>
<li>查阅以上版本浏览器所支持的语法规范</li>
<li>根据上一步分析得到的规范来选择 babel 的 plugin 与 preset</li>
<li>放弃该想法</li>
</ol>
<p>虽然上述的分析是正确的，但是真正要实现起来是非常复杂的，所以我们基本上可以放弃，那么有没有更加“傻瓜”一点的方法了，babel-preset-env 就是为了解决该问题。</p>
<p>babel-preset-env 的目的是通过配置目标环境的特点，然后只做必要的转换。例如目标浏览器支持 ES6规范，那么就不需要将 ES6 转换为 ES5的，打包后的代码体积会小很多，我们看下面的配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;presets&quot;: [</span><br><span class="line">    [&quot;env&quot;, &#123;</span><br><span class="line">      &quot;targets&quot;: &#123;</span><br><span class="line">        &quot;browsers&quot;: [&quot;last 2 versions&quot;, &quot;safari &gt;= 7&quot;]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如上配置将考虑所有浏览器的最新2个版本( safari 大于等于7.0的版本)的特性，将必要的代码进行转换，而这些版本已有的功能就不进行转化了，具体配置我们可以参考 <a href="https://github.com/browserslist/browserslist" target="_blank" rel="noopener">browserslist</a> 。</p>
<p>假设我们不屑任何配置项，其默认会给我们配置 es2015 + es2016 + es2017 + es2018 + …(esNOW)，那么就意味着将代码全部转换为 ES5 规范。</p>
<h3 id="babel-register"><a href="#babel-register" class="headerlink" title="babel-register"></a>babel-register</h3><h3 id="babel-polyfill"><a href="#babel-polyfill" class="headerlink" title="babel-polyfill"></a>babel-polyfill</h3><p>babel 默认只会转换语法规范，但是不会在代码里面注入新的 API ，比如 Generator、Set、Maps 等全局对象，也不会在全局对象上加入新的方法（如Object.assign），即当你使用 <code>Object.assign</code> 时，是不会进行转换的。</p>
<p>babel-polyfill 就是为了解决这个问题，使用时，在所有运行代码之前增加 require(‘babel-polyfill)，或者如果你使用 webpack 作为打包工具，直接在 webpack.config.js 中将 babel-polyfill 放在 entry 第一个位置，并且 babel-polyfill 是作为 dependencies 而不是 devDependencies 。</p>
<p>当你这么做后，你会发现打包后的文件非常大，这是因为 babel-polyfill 实现了很多种 API，不管你用几个这里面的 API，都会给你打包进去，所以 babel-polyfill 有以下缺点：</p>
<ol>
<li>并不是按需加载，打包出的文件非常大。</li>
<li>污染全局变量，在很多原型链上都做了修改，这种情况会非常不可控。</li>
</ol>
<p>因此，在这个时间点，使用 babel-polyfill 已经不再是那么优雅了，因为我们已经有新的方案可以替代了。</p>
<h3 id="babel-runtime-amp-babel-plugin-transform-runtime"><a href="#babel-runtime-amp-babel-plugin-transform-runtime" class="headerlink" title="babel-runtime &amp; babel-plugin-transform-runtime"></a>babel-runtime &amp; babel-plugin-transform-runtime</h3><p>我们先来看一个例子，我们需要转换以下代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class Foo &#123;</span><br><span class="line">    method() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置 .babelrc ：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;plugins&quot;: [</span><br><span class="line">        &quot;transform-es2015-classes&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;presets&quot;: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>转换后的代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">var _createClass = function () &#123; // ... 很长的代码 &#125;();</span><br><span class="line"></span><br><span class="line">function _classCallCheck(instance, Constructor) &#123; </span><br><span class="line">    // ... 很长的代码</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let Foo = function () &#123;</span><br><span class="line">    function Foo() &#123;</span><br><span class="line">        _classCallCheck(this, Foo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _createClass(Foo, [&#123;</span><br><span class="line">        key: &quot;method&quot;,</span><br><span class="line">        value: function method() &#123;&#125;</span><br><span class="line">    &#125;]);</span><br><span class="line"></span><br><span class="line">    return Foo;</span><br><span class="line">&#125;();</span><br></pre></td></tr></table></figure>
<p>那么我们加入每个文件都用到了 class ，打包后就会有非常多的重复冗余的代码， babel-plugin-transform-runtime 就是来解决这件事情的。</p>
<p>我们安装依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save-dev babel-plugin-transform-runtime</span><br><span class="line">$ npm install --save babel-runtime</span><br></pre></td></tr></table></figure>
<p>改变 .babelrc :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;plugins&quot;: [</span><br><span class="line">        &quot;transform-runtime&quot;,</span><br><span class="line">        &quot;transform-es2015-classes&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;presets&quot;: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>打包后的代码将会是以下结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import _classCallCheck from &quot;babel-runtime/helpers/classCallCheck&quot;;</span><br><span class="line">import _createClass from &quot;babel-runtime/helpers/createClass&quot;;</span><br><span class="line"></span><br><span class="line">let Foo = function () &#123;</span><br><span class="line">    function Foo() &#123;</span><br><span class="line">        _classCallCheck(this, Foo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _createClass(Foo, [&#123;</span><br><span class="line">        key: &quot;method&quot;,</span><br><span class="line">        value: function method() &#123;&#125;</span><br><span class="line">    &#125;]);</span><br><span class="line"></span><br><span class="line">    return Foo;</span><br><span class="line">&#125;();</span><br></pre></td></tr></table></figure>
<p>这样就不需要把 _classCallCheck 和 _createClass 这两个助手方法放进每一个需要的文件里去了。</p>
<p>我们别忘了还有 babel-runtime 这个东西，那么这又是用来干嘛的呢，我们看上面代码头部，从 babel-runtime 里面引入了方法，那么 babel-runtime 就是集成了很多内置类或者方法，它主要集成了以下：</p>
<ol>
<li>core-js: 转换一些内置类 (Promise, Symbols等等) 和静态方法 (Array.from 等)。绝大部分转换是这里做的。自动引入。</li>
<li>regenerator: 主要是 generator/yield 和 async/await 两组的支持。当代码中有使用 generators/async 时自动引入。</li>
<li>helpers, 如 asyncToGenerator、jsx, classCallCheck 等等方法，具体可以查看 babel-helpers。</li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>babel 是整个前端视为几大巨头之一的工具，给我们开发过程带来了革命性的改变，随着 JavaScript 语言的演进，babel 也在进行不断的发展。本篇文章我们讲述了 babel 中几个非常重要的概念与工具，想要更加深入地探索 babel 光从概念来学习是不够的，还需要在实际开发中不断的实践与试错，才能优雅地用上 babel 。</p>

      
    </div>

    
      
      

  <div class="post-copyright">
    <p class="copyright-item">
      <span>原文作者: </span>
      <a href="https://vince.xin">Vince</a>
    </p>
    <p class="copyright-item">
      <span>原文链接: </span>
      <a href="https://vince.xin/2019/06/29/傻傻分不清之-——-babel-全家桶/">https://vince.xin/2019/06/29/傻傻分不清之-——-babel-全家桶/</a>
    </p>
    <p class="copyright-item">
      <span>许可协议: </span>
      
      <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>
    </p>
  </div>



      
      
    

    
      <footer class="post-footer">
        
        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2019/07/25/领域驱动设计在前端中的应用/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">领域驱动设计在前端中的应用</span>
        <span class="prev-text nav-mobile">上一篇</span>
      </a>
    
    
      <a class="next" href="/2019/06/22/通过开发-Babel-插件来理解什么是抽象语法树（AST）/">
        <span class="next-text nav-default">通过开发 Babel 插件来理解什么是抽象语法树（AST）</span>
        <span class="prev-text nav-mobile">下一篇</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>


      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:artistcoder@163.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          <a href="https://github.com/Vincedrean" class="iconfont icon-github" title="github"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    

    
      
      <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    
  </div>



<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://hexo.io/">Hexo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">
    
    &copy; 
     
      2017 - 
    
    2019

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Vince</span>
  </span>
</div>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  
  <script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'https://vince.xin/2019/06/29/傻傻分不清之-——-babel-全家桶/';
        this.page.identifier = '2019/06/29/傻傻分不清之-——-babel-全家桶/';
        this.page.title = '傻傻分不清之 —— babel 全家桶';
    };
    (function() {
    var d = document, s = d.createElement('script');

    s.src = '//vincehua.disqus.com/embed.js';

    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();  
  </script>

  

  



    
  



  
  





  
    <script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  

  
    <script type="text/javascript" src="/lib/pjax/jquery.pjax.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/nprogress/nprogress.min.js"></script>
  


    <script type="text/javascript" src="/js/src/even.js?v=2.10.2"></script>

  <script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>